// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User{
    id        String   @id @default(cuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    firstName String?
    lastName String?
    imageUrl String?

    emailAddress String @unique

    //one credit is one file being proccessed.
    //Default user can process 150 files.
    credits Int @default(150)

    UserToProjects UserToProject[]
}

//storing project details
model Project{
    id          String   @id @default(cuid())
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    projectName String
    repoUrl     String
    githubToken String?

    deletedAt   DateTime?

    UserToProjects UserToProject[]

    commits Commit[]
}

//many-many relationship. 1 User can have many Projects. 1 Project can have many Users
model UserToProject{
    id          String   @id @default(cuid())
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    userId String
    projectId String

    user User @relation(fields: [userId], references: [id])
    project Project @relation(fields: [projectId], references: [id])

    //compound key. Pair of 1 userId and 1 projectId
    @@unique([userId, projectId])
}

// model GithubUser{
//     id          String   @id @default(cuid())
//     createdAt   DateTime @default(now())
//     updatedAt   DateTime @updatedAt

//     githubId    String @unique
//     login       String
//     name        String?
//     avatarUrl   String?
//     email       String?
//     bio         String?
//     location    String?
//     twitter     String?
//     websiteUrl  String?
//     company     String?
//     hireable    Boolean?
//     followers   Int?
//     following   Int?
//     publicRepos Int?
//     publicGists Int?
//     lastSynced  DateTime?
// }

model Commit{
    id          String   @id @default(cuid())
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    projectId   String
    project     Project @relation(fields: [projectId], references: [id])

    commitHash        String @unique
    commitMessage     String
    commitAuthorName  String
    commitAuthorAvatar String
    commitDate        DateTime

    //ai summary
    summary String
}